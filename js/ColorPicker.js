var ColorPicker = function(selector) {
	var picker = $(selector.picker);
	var input = $(selector.input);
	var example = $(selector.example);
	if (input.val() && example.length) {
		example.css('backgroundColor', '#' + input.val());
	}
	var img = new Image();
	img.onload = function(evt) {
		var w = evt.target.width;
		var h = evt.target.height;
		var canvas = document.createElement('canvas');
		canvas.width = w;
		canvas.height = h;
		var c = canvas.getContext('2d');
		c.drawImage(evt.target, 0, 0);
		var pix = c.getImageData(0, 0, w, h);
		canvas.onclick=function(evt) {
			var pos = $(evt.target).position();
			var x = evt.x - pos.left;
			var y = evt.y - pos.top;
			var offset = (y * w + x) * 4;
			var color = Color.rgbToHex([pix.data[offset],pix.data[offset+1],pix.data[offset+2]]);
			input.val(color).change();
			if (example.length) {
				example.css('backgroundColor', '#' + input.val());
			}
		}
		canvas.onselectstart = function() {
			return false;
		}
		picker.append(canvas);
	}
	img.src = 'data:image/png;base64,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';
}
